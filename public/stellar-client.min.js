!function(t,e,n,r){e[t]=n.call(e);for(var o=0;o<r.length;o++)r[o](e[t]);"undefined"!=typeof module&&module.exports?module.exports=e[t]:"function"==typeof define&&define.amd&&define(function(){return e[t]})}("Primus",this||{},function(){return function(){return function t(e,n,r){function o(s,c){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){return o(e[s][1][t]||t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}}()({1:[function(t,e,n){"use strict";e.exports=function(t,e){var n=/[, ]+/;function r(t,r){if(e[t]){if("string"==typeof e[t]&&(e[t]=e[t].split(n)),"function"==typeof e[t])return e[t].call(r);for(var o,i,s=0;s<e[t].length;s++)"function"===(o=typeof(i=e[t][s]))?i.call(r):"string"===o&&"function"==typeof r[i]&&r[i]()}}return e=e||{},"string"==typeof(t=t||[])&&(t=t.split(n)),function(){var e,n=0;if(null===this[t[0]])return!1;for(r("before",this);n<t.length;n++)this[e=t[n]]&&("function"==typeof this[e].destroy&&this[e].destroy(),this[e]=null);return this.emit&&this.emit("destroy"),r("after",this),!0}}},{}],2:[function(t,e,n){"use strict";e.exports=function(){for(var t,e=this,n=0,r=arguments.length,o=new Array(r);n<r;n++)o[n]=arguments[n];return"function"!=typeof o[o.length-1]?function(){for(var t=0,n=arguments.length,r=new Array(n);t<n;t++)r[t]=arguments[t];return e.emit.apply(e,o.concat(r))}:(t=o.pop(),function(){for(var n=0,r=arguments.length,i=new Array(r+1);n<r;n++)i[n+1]=arguments[n];return i[0]=function(t,n){if(t)return e.emit("error",t);i=void 0===n?i.slice(1):null===n?[]:n,e.emit.apply(e,o.concat(i))},t.apply(e,i),!0})}},{}],3:[function(t,e,n){"use strict";var r=Object.prototype.hasOwnProperty,o="~";function i(){}function s(t,e,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new function(t,e,n){this.fn=t,this.context=e,this.once=n||!1}(n,r||t,i),c=o?o+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],s]:t._events[c].push(s):(t._events[c]=s,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(o=!1)),a.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(o?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=o?o+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,s=new Array(i);r<i;r++)s[r]=n[r].fn;return s},a.prototype.listenerCount=function(t){var e=o?o+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,r,i,s){var c=o?o+t:t;if(!this._events[c])return!1;var a,u,l=this._events[c],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,i),!0;case 6:return l.fn.call(l.context,e,n,r,i,s),!0}for(u=1,a=new Array(h-1);u<h;u++)a[u-1]=arguments[u];l.fn.apply(l.context,a)}else{var f,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,n);break;case 4:l[u].fn.call(l[u].context,e,n,r);break;default:if(!a)for(f=1,a=new Array(h-1);f<h;f++)a[f-1]=arguments[f];l[u].fn.apply(l[u].context,a)}}return!0},a.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,n,r){var i=o?o+t:t;if(!this._events[i])return this;if(!e)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==e||r&&!s.once||n&&s.context!==n||c(this,i);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==e||r&&!s[a].once||n&&s[a].context!==n)&&u.push(s[a]);u.length?this._events[i]=1===u.length?u[0]:u:c(this,i)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=o?o+t:t,this._events[e]&&c(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=o,a.EventEmitter=a,void 0!==e&&(e.exports=a)},{}],4:[function(t,e,n){"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}},{}],5:[function(t,e,n){"use strict";var r=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i");e.exports=function(t){var e,n,o=typeof t;if("number"===o)return t;if("string"!==o||"0"===t||!t)return 0;if(+t)return+t;if(t.length>1e4||!(n=r.exec(t)))return 0;switch(e=parseFloat(n[1]),n[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 31536e6*e;case"weeks":case"week":case"wks":case"wk":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;default:return e}}},{}],6:[function(t,e,n){"use strict";e.exports=function(t){var e,n=0;function r(){return n?e:(n=1,e=t.apply(this,arguments),t=null,e)}return r.displayName=t.displayName||t.name||r.displayName||r.name,r}},{}],7:[function(t,e,n){var r,o,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(t){r=s}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(t){o=c}}();var u,l=[],h=!1,f=-1;function p(){h&&u&&(h=!1,u.length?l=u.concat(l):f=-1,l.length&&m())}function m(){if(!h){var t=a(p);h=!0;for(var e=l.length;e;){for(u=l,l=[];++f<e;)u&&u[f].run();f=-1,e=l.length}u=null,h=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new d(t,e)),1!==l.length||h||a(m)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],8:[function(t,e,n){"use strict";var r,o=Object.prototype.hasOwnProperty;function i(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}n.stringify=function(t,e){e=e||"";var n,i,s=[];for(i in"string"!=typeof e&&(e="?"),t)if(o.call(t,i)){if((n=t[i])||null!==n&&n!==r&&!isNaN(n)||(n=""),i=encodeURIComponent(i),n=encodeURIComponent(n),null===i||null===n)continue;s.push(i+"="+n)}return s.length?e+s.join("&"):""},n.parse=function(t){for(var e,n=/([^=?&]+)=?([^&]*)/g,r={};e=n.exec(t);){var o=i(e[1]),s=i(e[2]);null===o||null===s||o in r||(r[o]=s)}return r}},{}],9:[function(t,e,n){"use strict";var r=t("eventemitter3"),o=t("millisecond"),i=t("demolish"),s=t("tick-tock"),c=t("one-time");function a(t,e,n){return o(t in n?n[t]:t in e?e[t]:u[t])}function u(t){if(!(this instanceof u))return new u(t);t=t||{},this.attempt=null,this._fn=null,this["reconnect timeout"]=a("reconnect timeout",this,t),this.retries=a("retries",this,t),this.factor=a("factor",this,t),this.max=a("max",this,t),this.min=a("min",this,t),this.timers=new s(this)}u.prototype=new r,u.prototype.constructor=u,u["reconnect timeout"]="30 seconds",u.max=1/0,u.min="500 ms",u.retries=10,u.factor=2,u.prototype.reconnect=function(){var t=this;return t.backoff(function(e,n){if(n.duration=+new Date-n.start,e)return t.emit("reconnect failed",e,n);t.emit("reconnected",n)},t.attempt)},u.prototype.backoff=function(t,e){var n=this;return(e=e||n.attempt||{}).backoff?n:(e["reconnect timeout"]=a("reconnect timeout",n,e),e.retries=a("retries",n,e),e.factor=a("factor",n,e),e.max=a("max",n,e),e.min=a("min",n,e),e.start=+e.start||+new Date,e.duration=+e.duration||0,e.attempt=+e.attempt||0,e.attempt===e.retries?(t.call(n,new Error("Unable to recover"),e),n):(e.backoff=!0,e.attempt++,n.attempt=e,e.scheduled=1!==e.attempt?Math.min(Math.round((Math.random()+1)*e.min*Math.pow(e.factor,e.attempt-1)),e.max):e.min,n.timers.setTimeout("reconnect",function(){e.duration=+new Date-e.start,e.backoff=!1,n.timers.clear("reconnect, timeout");var r=n._fn=c(function(r){if(n.reset(),r)return n.backoff(t,e);t.call(n,void 0,e)});n.emit("reconnect",e,r),n.timers.setTimeout("timeout",function(){var t=new Error("Failed to reconnect in a timely manner");e.duration=+new Date-e.start,n.emit("reconnect timeout",t,e),r(t)},e["reconnect timeout"])},e.scheduled),n.emit("reconnect scheduled",e),n))},u.prototype.reconnecting=function(){return!!this.attempt},u.prototype.reconnected=function(t){return this._fn&&this._fn(t),this},u.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},u.prototype.destroy=i("timers attempt _fn"),e.exports=u},{demolish:1,eventemitter3:10,millisecond:5,"one-time":6,"tick-tock":12}],10:[function(t,e,n){"use strict";var r="function"!=typeof Object.create&&"~";function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(t,e){var n=r?r+t:t,o=this._events&&this._events[n];if(e)return!!o;if(!o)return[];if(o.fn)return[o.fn];for(var i=0,s=o.length,c=new Array(s);i<s;i++)c[i]=o[i].fn;return c},i.prototype.emit=function(t,e,n,o,i,s){var c=r?r+t:t;if(!this._events||!this._events[c])return!1;var a,u,l=this._events[c],h=arguments.length;if("function"==typeof l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,o),!0;case 5:return l.fn.call(l.context,e,n,o,i),!0;case 6:return l.fn.call(l.context,e,n,o,i,s),!0}for(u=1,a=new Array(h-1);u<h;u++)a[u-1]=arguments[u];l.fn.apply(l.context,a)}else{var f,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,n);break;default:if(!a)for(f=1,a=new Array(h-1);f<h;f++)a[f-1]=arguments[f];l[u].fn.apply(l[u].context,a)}}return!0},i.prototype.on=function(t,e,n){var i=new o(e,n||this),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.once=function(t,e,n){var i=new o(e,n||this,!0),s=r?r+t:t;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.removeListener=function(t,e,n,o){var i=r?r+t:t;if(!this._events||!this._events[i])return this;var s=this._events[i],c=[];if(e)if(s.fn)(s.fn!==e||o&&!s.once||n&&s.context!==n)&&c.push(s);else for(var a=0,u=s.length;a<u;a++)(s[a].fn!==e||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);return c.length?this._events[i]=1===c.length?c[0]:c:delete this._events[i],this},i.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[r?r+t:t]:this._events=r?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=r,void 0!==e&&(e.exports=i)},{}],11:[function(t,e,n){"use strict";e.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},{}],12:[function(t,e,n){(function(n,r){"use strict";var o=Object.prototype.hasOwnProperty,i=t("millisecond");function s(t,e,n,r){this.start=+new Date,this.duration=n,this.clear=e,this.timer=t,this.fns=[r]}function c(t){clearTimeout(t)}function a(t){clearInterval(t)}function u(t){r(t)}function l(t){if(!(this instanceof l))return new l(t);this.timers={},this.context=t||this}s.prototype.remaining=function(){return this.duration-this.taken()},s.prototype.taken=function(){return+new Date-this.start},l.prototype.tock=function(t,e){var n=this;return function(){if(t in n.timers){var r=n.timers[t].fns.slice(),o=r.length,i=0;for(e?n.clear(t):n.start=+new Date;i<o;i++)r[i].call(n.context)}}},l.prototype.setTimeout=function(t,e,n){var r;return this.timers[t]?(this.timers[t].fns.push(e),this):(r=i(n),this.timers[t]=new s(setTimeout(this.tock(t,!0),i(n)),c,r,e),this)},l.prototype.setInterval=function(t,e,n){var r;return this.timers[t]?(this.timers[t].fns.push(e),this):(r=i(n),this.timers[t]=new s(setInterval(this.tock(t),i(n)),a,r,e),this)},l.prototype.setImmediate=function(t,e){return"function"!=typeof n?this.setTimeout(t,e,0):this.timers[t]?(this.timers[t].fns.push(e),this):(this.timers[t]=new s(n(this.tock(t,!0)),u,0,e),this)},l.prototype.active=function(t){return t in this.timers},l.prototype.clear=function(){var t,e,n,r=arguments.length?arguments:[];if(1===r.length&&"string"==typeof r[0]&&(r=r[0].split(/[, ]+/)),!r.length)for(t in this.timers)o.call(this.timers,t)&&r.push(t);for(e=0,n=r.length;e<n;e++)(t=this.timers[r[e]])&&(t.clear(t.timer),t.fns=t.timer=t.clear=null,delete this.timers[r[e]]);return this},l.prototype.adjust=function(t,e){var n,r=i(e),o=this.timers[t];return o?(n=o.clear===a,o.clear(o.timer),o.start=+new Date,o.duration=r,o.timer=(n?setInterval:setTimeout)(this.tock(t,!n),r),this):this},l.prototype.end=l.prototype.destroy=function(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},l.Timer=s,e.exports=l}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{millisecond:5,timers:13}],13:[function(t,e,n){(function(e,r){var o=t("process/browser.js").nextTick,i=Function.prototype.apply,s=Array.prototype.slice,c={},a=0;function u(t,e){this._id=t,this._clearFn=e}n.setTimeout=function(){return new u(i.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new u(i.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t.close()},u.prototype.unref=u.prototype.ref=function(){},u.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n.setImmediate="function"==typeof e?e:function(t){var e=a++,r=!(arguments.length<2)&&s.call(arguments,1);return c[e]=!0,o(function(){c[e]&&(r?t.apply(null,r):t.call(null),n.clearImmediate(e))}),e},n.clearImmediate="function"==typeof r?r:function(t){delete c[t]}}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":7,timers:13}],14:[function(t,e,n){(function(n){"use strict";var r=t("requires-port"),o=t("querystringify"),i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,s=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,c=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function a(t){return(t||"").toString().replace(c,"")}var u=[["#","hash"],["?","query"],function(t){return t.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],l={hash:1,query:1};function h(t){var e,r=("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{}).location||{},o={},s=typeof(t=t||r);if("blob:"===t.protocol)o=new p(unescape(t.pathname),{});else if("string"===s)for(e in o=new p(t,{}),l)delete o[e];else if("object"===s){for(e in t)e in l||(o[e]=t[e]);void 0===o.slashes&&(o.slashes=i.test(t.href))}return o}function f(t){t=a(t);var e=s.exec(t);return{protocol:e[1]?e[1].toLowerCase():"",slashes:!!e[2],rest:e[3]}}function p(t,e,n){if(t=a(t),!(this instanceof p))return new p(t,e,n);var i,s,c,l,m,d,y=u.slice(),v=typeof e,g=this,w=0;for("object"!==v&&"string"!==v&&(n=e,e=null),n&&"function"!=typeof n&&(n=o.parse),e=h(e),i=!(s=f(t||"")).protocol&&!s.slashes,g.slashes=s.slashes||i&&e.slashes,g.protocol=s.protocol||e.protocol||"",t=s.rest,s.slashes||(y[3]=[/(.*)/,"pathname"]);w<y.length;w++)"function"!=typeof(l=y[w])?(c=l[0],d=l[1],c!=c?g[d]=t:"string"==typeof c?~(m=t.indexOf(c))&&("number"==typeof l[2]?(g[d]=t.slice(0,m),t=t.slice(m+l[2])):(g[d]=t.slice(m),t=t.slice(0,m))):(m=c.exec(t))&&(g[d]=m[1],t=t.slice(0,m.index)),g[d]=g[d]||i&&l[3]&&e[d]||"",l[4]&&(g[d]=g[d].toLowerCase())):t=l(t);n&&(g.query=n(g.query)),i&&e.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==e.pathname)&&(g.pathname=function(t,e){if(""===t)return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,o=n[r-1],i=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(i=!0),n.splice(r,1),s--);return i&&n.unshift(""),"."!==o&&".."!==o||n.push(""),n.join("/")}(g.pathname,e.pathname)),r(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(l=g.auth.split(":"),g.username=l[0]||"",g.password=l[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}p.prototype={set:function(t,e,n){var i=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(n||o.parse)(e)),i[t]=e;break;case"port":i[t]=e,r(e,i.protocol)?e&&(i.host=i.hostname+":"+e):(i.host=i.hostname,i[t]="");break;case"hostname":i[t]=e,i.port&&(e+=":"+i.port),i.host=e;break;case"host":i[t]=e,/:\d+$/.test(e)?(e=e.split(":"),i.port=e.pop(),i.hostname=e.join(":")):(i.hostname=e,i.port="");break;case"protocol":i.protocol=e.toLowerCase(),i.slashes=!n;break;case"pathname":case"hash":if(e){var s="pathname"===t?"/":"#";i[t]=e.charAt(0)!==s?s+e:e}else i[t]=e;break;default:i[t]=e}for(var c=0;c<u.length;c++){var a=u[c];a[4]&&(i[a[1]]=i[a[1]].toLowerCase())}return i.origin=i.protocol&&i.host&&"file:"!==i.protocol?i.protocol+"//"+i.host:"null",i.href=i.toString(),i},toString:function(t){t&&"function"==typeof t||(t=o.stringify);var e,n=this,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var i=r+(n.slashes?"//":"");return n.username&&(i+=n.username,n.password&&(i+=":"+n.password),i+="@"),i+=n.host+n.pathname,(e="object"==typeof n.query?t(n.query):n.query)&&(i+="?"!==e.charAt(0)?"?"+e:e),n.hash&&(i+=n.hash),i}},p.extractProtocol=f,p.location=h,p.trimLeft=a,p.qs=o,e.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:8,"requires-port":11}],15:[function(t,e,n){"use strict";var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,s={},c=0,a=0;function u(t){var e="";do{e=o[t%i]+e,t=Math.floor(t/i)}while(t>0);return e}function l(){var t=u(+new Date);return t!==r?(c=0,r=t):t+"."+u(c++)}for(;a<i;a++)s[o[a]]=a;l.encode=u,l.decode=function(t){var e=0;for(a=0;a<t.length;a++)e=e*i+s[t.charAt(a)];return e},e.exports=l},{}],16:[function(t,e,n){"use strict";var r,o=t("eventemitter3"),i=t("tick-tock"),s=t("recovery"),c=t("querystringify"),a=t("inherits"),u=t("demolish"),l=t("yeast"),h=/\u2028/g,f=/\u2029/g;function p(t,e){if(!(t instanceof m)){var n=new Error("Primus#"+e+"'s context should called with a Primus instance");if("function"!=typeof t.listeners||!t.listeners("error").length)throw n;t.emit("error",n)}}try{r=location.origin?location.origin:location.protocol+"//"+location.host}catch(t){r="http://127.0.0.1"}function m(t,e){if(!(this instanceof m))return new m(t,e);if(m.Stream.call(this),"function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));if("object"==typeof t?t=(e=t).url||e.uri||r:e=e||{},"ping"in e||"pong"in e)return this.critical(new Error("The `ping` and `pong` options have been removed"));var n=this;e.queueSize="queueSize"in e?e.queueSize:1/0,e.timeout="timeout"in e?e.timeout:1e4,e.reconnect="reconnect"in e?e.reconnect:{},e.pingTimeout="pingTimeout"in e?e.pingTimeout:45e3,e.strategy="strategy"in e?e.strategy:[],e.transport="transport"in e?e.transport:{},n.buffer=[],n.writable=!0,n.readable=!0,n.url=n.parse(t||r),n.readyState=m.CLOSED,n.options=e,n.timers=new i(this),n.socket=null,n.disconnect=!1,n.transport=e.transport,n.transformers={outgoing:[],incoming:[]},n.recovery=new s(e.reconnect),"string"==typeof e.strategy&&(e.strategy=e.strategy.split(/\s?,\s?/g)),!1===e.strategy?e.strategy=[]:e.strategy.length||(e.strategy.push("disconnect","online"),this.authorization||e.strategy.push("timeout")),e.strategy=e.strategy.join(",").toLowerCase(),"websockets"in e&&(n.AVOID_WEBSOCKETS=!e.websockets),"network"in e&&(n.NETWORK_EVENTS=e.network),e.manual||n.timers.setTimeout("open",function(){n.timers.clear("open"),n.open()},0),n.initialise(e)}m.requires=m.require=function(e){if("function"==typeof t)return t(e)};try{m.Stream=m.requires("stream")}catch(t){}m.Stream||(m.Stream=o),a(m,m.Stream),m.OPENING=1,m.CLOSED=2,m.OPEN=3,m.prototype.AVOID_WEBSOCKETS=!1,m.prototype.NETWORK_EVENTS=!1,m.prototype.online=!0;try{(m.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(m.prototype.online=!1))}catch(t){}if(m.prototype.ark={},m.prototype.emits=t("emits"),m.prototype.plugin=function(t){if(p(this,"plugin"),t)return this.ark[t];var e={};for(t in this.ark)e[t]=this.ark[t];return e},m.prototype.reserved=function(t){return/^(incoming|outgoing)::/.test(t)||t in this.reserved.events},m.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,destroy:1,online:1,error:1,close:1,open:1,data:1,end:1},m.prototype.initialise=function(t){var e=this;for(var n in e.recovery.on("reconnected",e.emits("reconnected")).on("reconnect failed",e.emits("reconnect failed",function(t){e.emit("end"),t()})).on("reconnect timeout",e.emits("reconnect timeout")).on("reconnect scheduled",e.emits("reconnect scheduled")).on("reconnect",e.emits("reconnect",function(t){e.emit("outgoing::reconnect"),t()})),e.on("outgoing::open",function(){var t=e.readyState;e.readyState=m.OPENING,t!==e.readyState&&e.emit("readyStateChange","opening")}),e.on("incoming::open",function(){var t=e.readyState;if(e.recovery.reconnecting()&&e.recovery.reconnected(),e.writable=!0,e.readable=!0,e.online||(e.online=!0,e.emit("online")),e.readyState=m.OPEN,t!==e.readyState&&e.emit("readyStateChange","open"),e.heartbeat(),e.buffer.length){var n=e.buffer.slice(),r=n.length,o=0;for(e.buffer.length=0;o<r;o++)e._write(n[o])}e.emit("open")}),e.on("incoming::ping",function(t){e.online=!0,e.heartbeat(),e.emit("outgoing::pong",t),e._write("primus::pong::"+t)}),e.on("incoming::error",function(t){var n=e.timers.active("connect"),r=t;if("string"==typeof t)r=new Error(t);else if(!(t instanceof Error)&&"object"==typeof t)for(var o in r=new Error(t.message||t.reason),t)Object.prototype.hasOwnProperty.call(t,o)&&(r[o]=t[o]);if(e.recovery.reconnecting())return e.recovery.reconnected(r);e.listeners("error").length&&e.emit("error",r),n&&(~e.options.strategy.indexOf("timeout")?e.recovery.reconnect():e.end())}),e.on("incoming::data",function(t){e.decoder(t,function(n,r){if(n)return e.listeners("error").length&&e.emit("error",n);e.protocol(r)||e.transforms(e,e,"incoming",r,t)})}),e.on("incoming::end",function(){var t=e.readyState;return e.disconnect?(e.disconnect=!1,e.end()):(e.readyState=m.CLOSED,t!==e.readyState&&e.emit("readyStateChange","end"),e.timers.active("connect")&&e.end(),t!==m.OPEN?!!e.recovery.reconnecting()&&e.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),e.emit("close"),~e.options.strategy.indexOf("disconnect")?e.recovery.reconnect():(e.emit("outgoing::end"),void e.emit("end"))))}),e.client(),e.ark)e.ark[n].call(e,e,t);return e.NETWORK_EVENTS?(e.offlineHandler=function(){e.online&&(e.online=!1,e.emit("offline"),e.end(),e.recovery.reset())},e.onlineHandler=function(){e.online||(e.online=!0,e.emit("online"),~e.options.strategy.indexOf("online")&&e.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",e.offlineHandler,!1),window.addEventListener("online",e.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",e.offlineHandler),document.body.attachEvent("ononline",e.onlineHandler)),e):e},m.prototype.protocol=function(t){if("string"!=typeof t||0!==t.indexOf("primus::"))return!1;var e=t.indexOf(":",8),n=t.slice(e+2);switch(t.slice(8,e)){case"ping":this.emit("incoming::ping",+n);break;case"server":"close"===n&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",n);break;default:return!1}return!0},m.prototype.transforms=function(t,e,n,r,o){var i={data:r},s=t.transformers[n];return function t(n,r){var o=s[n++];if(!o)return r();if(1===o.length){if(!1===o.call(e,i))return;return t(n,r)}o.call(e,i,function(o,i){if(o)return e.emit("error",o);!1!==i&&t(n,r)})}(0,function(){if("incoming"===n)return e.emit("data",i.data,o);e._write(i.data)}),this},m.prototype.id=function(t){return this.socket&&this.socket.id?t(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",t))},m.prototype.open=function(){return p(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},m.prototype.write=function(t){return p(this,"write"),this.transforms(this,this,"outgoing",t),!0},m.prototype._write=function(t){var e=this;return m.OPEN!==e.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(t),!1):(e.encoder(t,function(t,n){if(t)return e.listeners("error").length&&e.emit("error",t);"string"==typeof n&&(~n.indexOf("\u2028")&&(n=n.replace(h,"\\u2028")),~n.indexOf("\u2029")&&(n=n.replace(f,"\\u2029"))),e.emit("outgoing::data",n)}),!0)},m.prototype.heartbeat=function(){return this.options.pingTimeout?(this.timers.clear("heartbeat"),this.timers.setTimeout("heartbeat",function(){this.online&&(this.online=!1,this.emit("offline"),this.emit("incoming::end"))},this.options.pingTimeout),this):this},m.prototype.timeout=function(){var t=this;function e(){t.removeListener("error",e).removeListener("open",e).removeListener("end",e).timers.clear("connect")}return t.timers.setTimeout("connect",function(){e(),t.readyState===m.OPEN||t.recovery.reconnecting()||(t.emit("timeout"),~t.options.strategy.indexOf("timeout")?t.recovery.reconnect():t.end())},t.options.timeout),t.on("error",e).on("open",e).on("end",e)},m.prototype.end=function(t){if(p(this,"end"),this.readyState===m.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==t&&this.write(t),this.writable=!1,this.readable=!1;var e=this.readyState;return this.readyState=m.CLOSED,e!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},m.prototype.destroy=u("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),m.prototype.clone=function(t){return this.merge({},t)},m.prototype.merge=function(t){for(var e,n,r=1;r<arguments.length;r++)for(e in n=arguments[r])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t},m.prototype.parse=t("url-parse"),m.prototype.querystring=c.parse,m.prototype.querystringify=c.stringify,m.prototype.uri=function(t){var e=this.url,n=[],r=!1;t.query&&(r=!0),(t=t||{}).protocol="protocol"in t?t.protocol:"http:",t.query=!(!e.query||!r)&&e.query.slice(1),t.secure="secure"in t?t.secure:"https:"===e.protocol||"wss:"===e.protocol,t.auth="auth"in t?t.auth:e.auth,t.pathname="pathname"in t?t.pathname:this.pathname,t.port="port"in t?+t.port:+e.port||(t.secure?443:80);var o=this.querystring(t.query||"");return o._primuscb=l(),t.query=this.querystringify(o),this.emit("outgoing::url",t),n.push(t.secure?t.protocol.replace(":","s:"):t.protocol,""),n.push(t.auth?t.auth+"@"+e.host:e.host),t.pathname&&n.push(t.pathname.slice(1)),r?n[n.length-1]+="?"+t.query:delete t.query,t.object?t:n.join("/")},m.prototype.transform=function(t,e){return p(this,"transform"),t in this.transformers?(this.transformers[t].push(e),this):this.critical(new Error("Invalid transformer type"))},m.prototype.critical=function(t){if(this.emit("error",t))return this;throw t},m.connect=function(t,e){return new m(t,e)},m.EventEmitter=o,m.prototype.client=function(){var t,e=this,n=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return m.requires("ws")}catch(t){}}();if(!n)return e.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"));e.on("outgoing::open",function(){e.emit("outgoing::end");try{var r={protocol:"ws+unix:"===e.url.protocol?"ws+unix:":"ws:",query:!0};3===n.length?("ws+unix:"===r.protocol&&(r.pathname=e.url.pathname+":"+e.pathname),e.socket=t=new n(e.uri(r),[],e.transport)):(e.socket=t=new n(e.uri(r)),t.binaryType="arraybuffer")}catch(t){return e.emit("error",t)}t.onopen=e.emits("incoming::open"),t.onerror=e.emits("incoming::error"),t.onclose=e.emits("incoming::end"),t.onmessage=e.emits("incoming::data",function(t,e){t(void 0,e.data)})}),e.on("outgoing::data",function(r){if(t&&t.readyState===n.OPEN)try{t.send(r)}catch(t){e.emit("incoming::error",t)}}),e.on("outgoing::reconnect",function(){e.emit("outgoing::open")}),e.on("outgoing::end",function(){t&&(t.onerror=t.onopen=t.onclose=t.onmessage=function(){},t.close(),t=null)})},m.prototype.authorization=!1,m.prototype.pathname="/primus",m.prototype.encoder=function(t,e){var n;try{t=JSON.stringify(t)}catch(t){n=t}e(n,t)},m.prototype.decoder=function(t,e){var n;if("string"!=typeof t)return e(n,t);try{t=JSON.parse(t)}catch(t){n=t}e(n,t)},m.prototype.version="7.3.4","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",function(t){27===t.keyCode&&t.preventDefault&&t.preventDefault()},!1);var d=(navigator.userAgent||"").toLowerCase(),y=d.match(/.+(?:rv|it|ra|ie)[/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],v=+[y[1],y[2]].join(".");!~d.indexOf("chrome")&&~d.indexOf("safari")&&v<534.54&&(m.prototype.AVOID_WEBSOCKETS=!0)}e.exports=m},{demolish:1,emits:2,eventemitter3:3,inherits:4,querystringify:8,recovery:9,"tick-tock":12,"url-parse":14,yeast:15}]},{},[16])(16)},[]),function(t){"use strict";function e(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function r(o,i){try{var s=e[o](i),c=s.value}catch(t){return void n(t)}if(!s.done)return Promise.resolve(c).then(function(t){r("next",t)},function(t){r("throw",t)});t(c)}("next")})}}const n=t=>"function"==typeof t;class r{constructor(t,e){this.client=e,Array.isArray(t)?this.rooms=t:this.rooms=[t]}_innerRoomAdd(t){return Array.isArray(t)?this.rooms=this.rooms.concat(t):this.rooms.push(t),this}to(t){return this._innerRoomAdd(t)}emit(t,e){const n=[];return this.rooms.forEach(r=>{n.push(this.client.send({event:"event",params:{room:r,event:t,data:e}}))}),Promise.all(n)}from(t){return this._innerRoomAdd(t)}on(t,e){return this.rooms.forEach(n=>{this.client.on(`[${n}].${t}`,e)}),this}off(t,e){return this.rooms.forEach(n=>{this.client.removeListener(`[${n}].${t}`,e)}),this}}const o=function(t,e){this.callbacks={},this.id=null,this.events={},this.rooms=[],this.state="disconnected",this.messageCount=0,this.pendingRequestsQueue=[],this.pendingRequestsCounter=0,this.options=this.defaults()||{};for(const e in t)this.options[e]=t[e];e&&(this.externalClient=!0,this.client=e),void 0!==Promise&&"function"==typeof Promise||(t=>console.error(`[StellarClient error]: ${t}`))("The browser does not support Promises, you must load a polyfill before load Stellar client lib")};if("undefined"==typeof Primus){const t=require("util"),e=require("events").EventEmitter;t.inherits(o,e)}else o.prototype=new Primus.EventEmitter;var i,s,c;o.prototype.interceptors=[],o.prototype.defaults=function(){return{apiPath:"/api",defaultRoom:"defaultRoom",url:window.location.origin,simultaneousActions:5}},o.prototype.connect=function(){return this.messageCount=0,new Promise((t,e)=>{this.client&&!0!==this.externalClient?(this.client.end(),this.client.removeAllListeners(),this.client=Primus.connect(this.options.url,this.options)):null!==this.client&&!0===this.externalClient?(this.client.end(),this.client.open()):this.client=Primus.connect(this.options.url,this.options),this.client.on("open",()=>{this.configure().then(e=>{"connected"!==this.state&&(this.state="connected",t(e)),this._emit("connected")})}),this.client.on("error",t=>{e(t),this._emit("error",t)}),this.client.on("reconnect",()=>{this.messageCount=0,this._emit("reconnect")}),this.client.on("reconnecting",()=>{this._emit("reconnecting"),this.state="reconnecting",this._emit("disconnected")}),this.client.on("timeout",()=>{this.state="timeout",this._emit("timeout")}),this.client.on("end",()=>{this.messageCount=0,"disconnected"!==this.state&&(this.state="disconnected",this._emit("disconnected"))}),this.client.on("data",t=>this.handleMessage(t))})},o.prototype.configure=function(){return new Promise(t=>{this.options.rooms&&this.options.rooms.forEach(t=>this.send({event:"roomAdd",room:t})),this.detailsView().then(e=>{this.id=e.data.id,this.fingerprint=e.data.fingerprint,this.rooms=e.data.rooms,t(e)})})},o.prototype.processNextPendingRequest=function(){if(0===this.pendingRequestsQueue.length)return;this.pendingRequestsQueue.shift()()},o.prototype.send=function(t){return new Promise(e=>{this.messageCount++,this.callbacks[this.messageCount]=e,this.client.write(t)})},o.prototype.handleMessage=function(t){if(this._emit("message",t),"response"===t.context)"function"==typeof this.callbacks[t.messageCount]&&this.callbacks[t.messageCount](t),delete this.callbacks[t.messageCount];else if("user"===t.context){if(this._emit("say",t),t.message.event){const e=t.message;this._emit(e.event,e.data,t),this._emit(`[${t.room}].${e.event}`,e.data,t)}}else"alert"===t.context?this._emit("alert",t):t.welcome&&"api"===t.context?(this.welcomeMessage=t.welcome,this._emit("welcome",t)):"api"===t.context&&this._emit("api",t)},o.prototype.action=function(t,e={}){return new Promise((r,o)=>{let i=null;const s=this.interceptors.slice(0),c=[];e.action=t;const a=(t,e)=>{if(void 0!==e&&null!==e)return c.forEach(t=>{t.call(this,e)}),o(e);if(n(t))c.unshift(t);else if((t=>null!==t&&"object"==typeof t)(t))return c.forEach(e=>{e.call(this,t)}),r(t);u()},u=()=>{if(0===s.length){let t=null;t="connected"!==this.state?this._actionWeb:this._actionWebSocket,this.pendingRequestsCounter+=1;const n=()=>{t.call(this,e).then(t=>{a(t)}).catch(t=>{a(null,t)}).then(()=>{this.pendingRequestsCounter-=1,this.processNextPendingRequest()})};return this.pendingRequestsCounter>=this.options.simultaneousActions?this.pendingRequestsQueue.push(n):void n()}i=s.pop(),n(i)?i.call(this,e,a,o):((t=>console.warn(`[StellarClient warn]: ${t}`))(`Invalid interceptor of type ${typeof i}, must be a function`),a())};u()})},o.prototype._actionWeb=(i=e(function*(t){const e=(t.httpMethod||"POST").toUpperCase();let n=`${this.options.url}${this.options.apiPath}?action=${t.action}`;if("GET"===e)for(let e in t)~["action","httpMethod"].indexOf(e)||(n+=`&${e}=${t[e]}`);const r={method:e,mode:"cors",headers:new Headers({"Content-Type":"application/json"})};"POST"===e&&(r.body=JSON.stringify(t));const o=new Request(n,r),i=yield fetch(o);if(200!==i.status)throw yield i.json();return i.json()}),function(t){return i.apply(this,arguments)}),o.prototype._actionWebSocket=function(t){return new Promise((e,n)=>{this.send({event:"action",params:t}).then(t=>{void 0===t.error?e(t):n(t)})})},o.prototype._emit=o.prototype.emit,o.prototype.emit=function(t=null,e=null){const n=this.options.defaultRoom;return this.send({event:"event",params:{event:t,room:n,data:e}})},o.prototype.to=function(t){return new r(t,this)},o.prototype.from=function(t){return new r(t,this)},o.prototype.off=function(t,e){return this.removeListener(t,e)},o.prototype.say=function(t,e){return void 0===e&&(e=t,t=this.options.defaultRoom),this.to(t).emit("message",e)},o.prototype.file=function(t){return this.send({event:"file",file:t})},o.prototype.detailsView=function(){return this.send({event:"detailsView"})},o.prototype.roomView=function(t){return this.send({event:"roomView",room:t})},o.prototype.join=(s=e(function*(t){return yield this.send({event:"roomJoin",room:t}),this.configure()}),function(t){return s.apply(this,arguments)}),o.prototype.leave=(c=e(function*(t){let e=this.rooms.indexOf(t);return e>-1&&this.rooms.splice(e,1),yield this.send({event:"roomLeave",room:t}),this.configure()}),function(t){return c.apply(this,arguments)}),o.prototype.disconnect=function(){this.state="disconnected",this.client.end(),this._emit("disconnected")},t.StellarClient=o,t.StellarClient=o}("undefined"==typeof exports?window:exports);